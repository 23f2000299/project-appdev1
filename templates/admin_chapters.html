{% extends 'base.html' %}
{% block title %}Chapter editing{% endblock %}

{% block content %}
<div class="list-group mt-2 ml-3 mr-2 mb-2">
  <h2>Chapters for {{ subject.name }}</h2>
  <p>{{ subject.description or '' }}</p>
  
  <!-- List of Chapters -->
  <!--using for list of items mb-3 from bootstrap to give bottom spacing-->
  <ul class="list-group mb-3">
    {% for chapter in subject.chapters %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <strong>{{ chapter.name }}</strong><br>
          <small>{{ chapter.description or '' }}</small>
        </div>
        <div>
          <!-- Inline edit link
           btn-for applying bootstap style button
           btn-sm for small button
           btn-secondary,danger - for gray n red button -->
          
          <a href="#edit-chapter-{{ chapter.id }}" class="btn btn-sm btn-secondary mr-2">Edit</a>
          <!-- Delete chapter form -->
          <form method="POST" action="{{ url_for('delete_chapter', chapter_id=chapter.id) }}" style="display:inline;">
            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
          </form>
        </div>
      </li>

      <!-- Inline Edit Form for this chapter, hidden by default -->
      <div id="edit-chapter-{{ chapter.id }}" class="edit-form">
        <form method="POST" action="{{ url_for('edit_chapter', chapter_id=chapter.id) }}">
          <div class="form-group mt-2">
            <label>Chapter Name</label>
            <input name="name" value="{{ chapter.name }}" required>
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea 
              name="description" 
              class="form-control mb-2" 
              rows="3"
            >{{ chapter.description }}</textarea>
          </div>
          <button type="submit" class="btn btn-primary btn-sm">Save Changes</button>
          <!-- Cancel link to remove the #edit-chapter-... fragment from URL -->
          <a href="#close" class="btn btn-sm">Cancel</a>
        </form>
        <br>
      </div>
    {% else %}
      <li class="list-group-item">No chapters available.</li>
    {% endfor %}
  </ul>

  <!-- Add Chapter Form -->
  <h4>Add New Chapter</h4>
  <form method="POST" action="{{ url_for('add_chapter', subject_id=subject.id) }}">
    <div class="form-group">
      <label for="chapName">Name</label>
      <input id="chapName" class="form-control" required>
    </div>
    <div class="form-group">
      <label for="chapDesc">Description</label>
      <textarea id="chapDesc" class="form-control"></textarea>
    </div>
    <button type="submit" class="btn btn-success">Save</button>
  </form>

  <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary mt-3">Back to Dashboard</a>
</div>
{% endblock %}
