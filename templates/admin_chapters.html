{% extends 'base.html' %}
{% block title %}Manage Chapters{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Chapters for {{ subject.name }}</h2>
  <p>{{ subject.description or '' }}</p>
  
  <!-- List of Chapters -->
  <ul class="list-group mb-3">
    {% for chapter in subject.chapters %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <strong>{{ chapter.name }}</strong><br>
          <small>{{ chapter.description or '' }}</small>
        </div>
        <div>
          <!-- Inline edit link -->
          <a href="#edit-chapter-{{ chapter.id }}" class="btn btn-sm btn-secondary mr-2">Edit</a>
          <!-- Delete chapter form -->
          <form method="POST" action="{{ url_for('delete_chapter', chapter_id=chapter.id) }}" style="display:inline;">
            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
          </form>
        </div>
      </li>

      <!-- Inline Edit Form for this chapter, hidden by default (use :target in CSS) -->
      <div id="edit-chapter-{{ chapter.id }}" class="edit-form">
        <form method="POST" action="{{ url_for('edit_chapter', chapter_id=chapter.id) }}">
          <div class="form-group mt-2">
            <label>Chapter Name</label>
            <input 
              type="text" 
              name="name" 
              value="{{ chapter.name }}" 
              class="form-control mb-2" 
              required
            >
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea 
              name="description" 
              class="form-control mb-2" 
              rows="3"
            >{{ chapter.description }}</textarea>
          </div>
          <button type="submit" class="btn btn-primary btn-sm">Save Changes</button>
          <!-- Cancel link to remove the #edit-chapter-... fragment from URL -->
          <a href="#close" class="btn btn-link btn-sm">Cancel</a>
        </form>
      </div>
    {% else %}
      <li class="list-group-item">No chapters available.</li>
    {% endfor %}
  </ul>

  <!-- Add Chapter Form -->
  <h4>Add New Chapter</h4>
  <form method="POST" action="{{ url_for('add_chapter', subject_id=subject.id) }}">
    <div class="form-group">
      <label for="chapterName">Name</label>
      <input 
        type="text" 
        name="chapter_name" 
        id="chapterName" 
        class="form-control" 
        required
      >
    </div>
    <div class="form-group">
      <label for="chapterDesc">Description</label>
      <textarea 
        name="chapter_description" 
        id="chapterDesc" 
        class="form-control"
      ></textarea>
    </div>
    <button type="submit" class="btn btn-success">Save</button>
  </form>

  <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary mt-3">Back to Dashboard</a>
</div>
{% endblock %}
